!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).index=e()}(this,function(){"use strict";var a=function(){return(a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function l(t,s,c,u){return new(c=c||Promise)(function(n,e){function i(t){try{o(u.next(t))}catch(t){e(t)}}function r(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(i,r)}o((u=u.apply(t,s||[])).next())})}function f(i,r){var o,s,c,u={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},a={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function t(n){return function(t){var e=[n,t];if(o)throw new TypeError("Generator is already executing.");for(;u=a&&e[a=0]?0:u;)try{if(o=1,s&&(c=2&e[0]?s.return:e[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,e[1])).done)return c;switch(s=0,(e=c?[2&e[0],c.value]:e)[0]){case 0:case 1:c=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,s=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(c=0<(c=u.trys).length&&c[c.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!c||e[1]>c[0]&&e[1]<c[3]))u.label=e[1];else if(6===e[0]&&u.label<c[1])u.label=c[1],c=e;else{if(!(c&&u.label<c[2])){c[2]&&u.ops.pop(),u.trys.pop();continue}u.label=c[2],u.ops.push(e)}}e=r.call(i,u)}catch(t){e=[6,t],s=0}finally{o=c=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}}function t(t){var u=this,e=(this.currApps=[],this.getMeasure=function(t){return new Promise(function(e){u.getList(t,"MeasureList").then(function(t){e(t.qMeasureList.qItems)})})},this.getVariable=function(t){return new Promise(function(e){u.getList(t,"VariableList").then(function(t){e(t.qVariableList.qItems)})})},this.getFields=function(t){return new Promise(function(e){u.getList(t,"FieldList").then(function(t){e(t.qFieldList.qItems)})})},this.getBookmark=function(t){return new Promise(function(e){u.getList(t,"BookmarkList").then(function(t){e(t.qBookmarkList.qItems)})})},this.evaluateExpression=function(n,i){return new Promise(function(e){var t;i&&" "!==i&&"object"==typeof i?n&&n.createGenericObject({value:{qStringExpression:null==(t=null==i?void 0:i.qStringExpression)?void 0:t.qExpr}},function(t){e(t.value),n.destroySessionObject(t.qInfo.qId)}):e(i)})},this.objectProper=function(s,c){return new Promise(function(e){var t=c.properties,n=t.title,i=t.subtitle,r=t.footnote,o={title:null,subtitle:null,footnote:null};u.evaluateExpression(s,n).then(function(t){return o.title=t,u.evaluateExpression(s,i)}).then(function(t){return o.subtitle=t,u.evaluateExpression(s,r)}).then(function(t){o.footnote=t,e(o)})})},this.getQlikObjectTitles=function(i,t){return new Promise(function(n){i.getObjectProperties(t).then(function(t){var e=t.properties;e.qExtendsId?i.getObjectProperties(e.qExtendsId).then(function(t){u.objectProper(i,t).then(function(t){n(t)})}):u.objectProper(i,t).then(function(t){n(t)})})})},this.getSheet=function(s){return new Promise(function(o){u.getList(s,"sheet").then(function(t){for(var r=[],e=function(t){for(var i=[],e=0,n=t.qData.cells;e<n.length;e++)!function(n){u.getQlikObjectTitles(s,n.name).then(function(t){var e=t.title||t.subtitle||t.footnote||n.name;i.push(a(a({},n),{options:t,obj_id:n.name,id:n.name,title:e}))}),t.obj=i}(n[e]);r.push(a(a({},t),{name:t.qMeta.title,id:t.qInfo.qId}))},n=0,i=t.qAppObjectList.qItems;n<i.length;n++)e(i[n]);o(r)})})},this.callObject=function(n,i){return new Promise(function(e){var t;null!=(t=n.visualization)&&t.get&&n.visualization.get(i).then(function(t){e(t)}).catch(function(t){console.log(t)})})},this.checkAppOpen=function(n){return new Promise(function(t,e){n.model.waitForOpen.promise.then(function(){t(n)}).catch(function(t){e(t)})})},this.isAppOpen=function(n){return l(u,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return e=this.qlik.openApp(n,this.config),[4,this.checkAppOpen(e)];case 1:return t.sent(),[2,e]}})})},t.host),n=t.port,i=t.prefix,r=t.isSecure,o=t.ticket,s=t.isSaaS,s=void 0!==s&&s,c=t.webIntegrationId,c=void 0===c?"":c,i="/"!==i?i:"/",r=r?"https://":"http://",n=n?":".concat(n):"";this.config=t,this.ticket=o,this.isSaaS=s,this.webIntegrationId=c,this.baseUrl="".concat(r).concat(e).concat(n).concat(i,"resources"),this.saasURL="".concat(r).concat(e).concat(n)}return t.prototype.callRequire=function(){var s=this;return new Promise(function(e,n){try{var i,t,r,o;document.getElementById("qlik-require-file")||((i=document.createElement("script")).src=s.ticket?"".concat(s.baseUrl,"/assets/external/requirejs/require.js?").concat(s.ticket):"".concat(s.baseUrl,"/assets/external/requirejs/require.js"),i.id="qlik-require-file",document.head.appendChild(i),t=new Promise(function(t,e){i.onload=function(){return t("loaded")},i.onerror=function(t){return e(t)}}),(r=document.createElement("link")).href="".concat(s.baseUrl,"/autogenerated/qlik-styles.css"),r.type="text/css",r.rel="stylesheet",document.head.insertBefore(r,document.head.firstChild),o=new Promise(function(t,e){r.onload=function(){return t("loaded")},r.onerror=function(t){return e(t)}}),Promise.all([t,o]).then(function(t){e(t)}).catch(function(t){n(t)}))}catch(t){console.log(t),n(t)}})},t.prototype.setQlik=function(){var i=this;return new Promise(function(e,n){window.require.config({baseUrl:i.baseUrl,paths:{qlik:"".concat(i.baseUrl,"/js/qlik")},config:{text:{useXhr:function(){return!0}}},webIntegrationId:i.isSaaS?i.webIntegrationId:""}),window.require(["js/qlik"],function(t){t&&(t.setOnError(function(t){n(t)}),i.qlik=t,e(t))})})},t.prototype.fetchAPI=function(t,e,n){return void 0===e&&(e="GET"),void 0===n&&(n=null),fetch(t,{method:e,mode:"cors",credentials:"include",headers:{"Content-Type":"application/json","qlik-web-integration-id":this.webIntegrationId},body:n}).then(function(t){return 200===t.status&&t.json()})},t.prototype.setAuthUser=function(){var r=this;return new Promise(function(i){r.qlik.callRepository("/api/hub/v1/user/info").then(function(t){var t=t.data.data[0],e=t.attributes,n=e.userDirectory,e=e.userId;r.user={directory:n,userId:e,authUser:t},i(!0)}).catch(function(t){console.log(t)})})},t.prototype.getDocs=function(){var n=this;return new Promise(function(e){n.qlik.getAppList(function(t){n.docList=t,e(t)},n.config)})},t.prototype.getList=function(n,t){return new Promise(function(e){n.getList(t,function(t){e(t),n.destroySessionObject(t.qInfo.qId)})})},t.prototype.getApp=function(c){return l(this,void 0,void 0,function(){var e,n,i,r,o,s;return f(this,function(t){switch(t.label){case 0:return this.currApps.find(function(t){return t.app.id===c})?[3,7]:[4,this.isAppOpen(c)];case 1:return e=t.sent(),[4,this.getSheet(e)];case 2:return n=t.sent(),[4,this.getMeasure(e)];case 3:return i=t.sent(),[4,this.getFields(e)];case 4:return r=t.sent(),[4,this.getVariable(e)];case 5:return o=t.sent(),[4,this.getBookmark(e)];case 6:return s=t.sent(),this.currApps=function(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||((i=i||Array.prototype.slice.call(e,0,r))[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}([{id:c,app:e,sheet:n,measure:i,fields:r,variable:o,bookmark:s}],this.currApps,!0),[2,this.currApps];case 7:return[2]}})})},t});
